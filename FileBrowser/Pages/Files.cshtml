@page "/files/{worknum}/{path?}"
@model FileBrowser.Pages.FilesModel
@{
    Layout = "_Layout";
}

<div class="main">
    @if(Model.Files.Count > 0)
    {
        @foreach(var item in Model.Files)
        {
            @if (item.FileType == FileType.Folder)
            {
                <div class="board file-item">
                    <div class="file-icon">
                        <i class="fa-solid fa-folder fa-3x fa-fw"></i>
                    </div>
                    <a href="@UrlEx.PageRouteLink("files", $"{Model.WorkNum}", item.Path)" onclick="onLink(event)">
                        <div class="file-text">
                            <div class="file-title">@item.Name</div>
                            <div class="file-description">@item.ItemCount</div>
                        </div>
                    </a>
                </div>
            }

            @if (item.FileType == FileType.Image)
            {
                <div class="image-board">
                    <div><img src="@UrlEx.PageRouteLink("api/file/image", $"{Model.WorkNum}", item.Path)" /></div>
                </div>
            }

            @if (item.FileType == FileType.Video)
            {
                <div class="board video-item">
                    <div class="video-image">
                        <img src="@UrlEx.PageRouteLink("api/file/thumbnail", $"{Model.WorkNum}", item.Path)" />
                    </div>
                    <a href="@UrlEx.PageRouteLink("video", $"{Model.WorkNum}", item.Path)" 
                        data-url="intent://@Model.Host@UrlEx.PageRouteLink("api/file/video", $"{Model.WorkNum}", item.Path)#Intent;{{package}}action=android.intent.action.VIEW;category=android.intent.category.DEFAULT;category=android.intent.category.BROWSABLE;scheme=@Model.Scheme;type=video/mp4;end"
                        onclick="onLink(event)"
                        class="video-link">
                        <div class="video-text">
                            <div class="video-title">@item.Name</div>
                            <div class="video-description">@item.FileSize</div>
                        </div>
                    </a>
                </div>
            }

            @if (item.FileType == FileType.Text)
            {
                <div class="board file-item">
                    <div class="file-icon">
                    <i class="fa-solid fa-file-lines fa-3x fa-fw"></i>
                    </div>
                    <a href="@UrlEx.PageRouteLink("text", $"{Model.WorkNum}", item.Path)" onclick="onLink(event)">
                        <div class="file-text">
                            <div class="file-title">@item.Name</div>
                            <div class="file-description">@item.FileSize</div>
                        </div>
                    </a>
                </div>
            }

            @if (item.FileType == FileType.Other)
            {
                <div class="board">
                    <div>@item.Name</div>
                </div>
            }
        }
    }
    else
    {
        <div class="board">
            <div>空的資料夾</div>
        </div>
    }

    @await Html.PartialAsync("_ControlPartial", new Control())
</div>

@section script {
    <script>
        var isUseDeepLink = storage.isUseDeepLink();
        var deepLinkPackage = storage.deepLinkPackage();
        var videoLinks = document.querySelectorAll('.video-link');
        for (var i = 0; i < videoLinks.length; i++) {
            if (isUseDeepLink) {
                var href = videoLinks[i].getAttribute('data-url');
                href = href.replace('{{package}}', deepLinkPackage === '' ? '' : 'package=' + deepLinkPackage + ';');
                videoLinks[i].href = href;
            }
            videoLinks[i].setAttribute('data-url', '');
        }
    </script>
}
